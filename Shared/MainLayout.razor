@inherits LayoutComponentBase
@inject ElectronNET.API.WindowManager WindowManager
@inject Blazored.LocalStorage.ILocalStorageService localStorageService
@inject Blazored.SessionStorage.ISessionStorageService sessionStorageService
@using NapelemEditor.Components

<PageTitle>Napelem BS</PageTitle>
<MudThemeProvider/>
<MudDialogProvider/>
<MudSnackbarProvider/>
<div class="page"> 
    <div class="sidebar">
        <NavMenu/>
    </div>
    <main>
        <div class="content px-4 auth">
            <MudPaper Width="100%" Class="d-flex align-content-end" Elevation="1" Style="background-color: #e9e9e9">
                <LoginDisplay isAuthenticated="isAuthenticated" role="role"/>
            </MudPaper>

            @Body
        </div>
    </main>
</div>


@code
{

    void close()
    {
        if (WindowManager.BrowserWindows.Count > 0)
        {
            WindowManager.BrowserWindows.First().Close();
        }
    }

    void maximize()
    {
        if (WindowManager.BrowserWindows.Count > 0)
        {
            WindowManager.BrowserWindows.First().Maximize();
        }
    }


    void minimize()
    {
        if (WindowManager.BrowserWindows.Count > 0)
        {
            WindowManager.BrowserWindows.First().Minimize();
        }
    }

    private bool isAuthenticated { get; set; }
    private int role { get; set; }
    private bool isDarkTheme;

    // private async void OnNavigation(object? obj, LocationChangedEventArgs args)
    // {
    //     var areValuesStored = await localStorageService.ContainKeyAsync("isAuthenticated");
    //     if (!areValuesStored)
    //     {
    //         areValuesStored = await sessionStorageService.ContainKeyAsync("isAuthenticated");
    //     }
    //     if (areValuesStored || uriHelper.Uri.EndsWith("/") || uriHelper.Uri.EndsWith("viewTestResult")) return;
    //     Snackbar.Add("Please login", Severity.Error);
    //
    //     uriHelper.NavigateTo("/");
    // }

    protected override async Task OnInitializedAsync()
    {
        try
        {
            if (await localStorageService.ContainKeyAsync("isAuthenticated"))
            {
                isAuthenticated = await localStorageService.GetItemAsync<bool>("isAuthenticated");
                role = await localStorageService.GetItemAsync<int>("role");
            }
            else
            {
                isAuthenticated = await sessionStorageService.GetItemAsync<bool>("isAuthenticated");
                role = await sessionStorageService.GetItemAsync<int>("role");
            }
        }
        catch
        {
            // ignored
        }
    }
}